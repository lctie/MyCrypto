//
//  MarketDataModel.swift
//  MyCrypto
//
//  Created by James Allen on 25/12/2024.
//

import Foundation

/*
    URL: https://api.coingecko.com/api/v3/global
 
    JSON:
 {
   "data": {
     "active_cryptocurrencies": 16285,
     "upcoming_icos": 0,
     "ongoing_icos": 49,
     "ended_icos": 3376,
     "markets": 1197,
     "total_market_cap": {
       "btc": 36502807.80707468,
       "eth": 1026388490.8048422,
       "ltc": 32942552814.32334,
       "bch": 7699966228.048341,
       "bnb": 5090242861.127387,
       "eos": 4151204093255.2397,
       "xrp": 1558299925417.527,
       "xlm": 9206309012517.318,
       "link": 144370920469.4636,
       "dot": 479932999498.6045,
       "yfi": 387064187.502118,
       "usd": 3582998626466.4067,
       "aed": 13160318125024.848,
       "ars": 3682530028711290.5,
       "aud": 5680088309552.302,
       "bdt": 427755896890843,
       "bhd": 1350554004268.4883,
       "bmd": 3582998626466.4067,
       "brl": 22405207011019.734,
       "cad": 5145006877674.435,
       "chf": 3223982164094.473,
       "clp": 3545305480915980.5,
       "cny": 26149082275814.484,
       "czk": 86548765021746.62,
       "dkk": 25697982748742.363,
       "eur": 3443784797833.681,
       "gbp": 2855811140231.9175,
       "gel": 10053894145864.736,
       "hkd": 27827896282245.32,
       "huf": 1417385886148653.2,
       "idr": 58091156730899850,
       "ils": 13065404491409.752,
       "inr": 305979035628699.3,
       "jpy": 563786625373802.1,
       "krw": 5223499882977339,
       "kwd": 1103710479895.3386,
       "lkr": 1054961433135163.8,
       "mmk": 7517131118326519,
       "mxn": 72251170885693.7,
       "myr": 16076914836954.766,
       "ngn": 5541347666050184,
       "nok": 40666317810668.4,
       "nzd": 6346085345243.999,
       "php": 209782770914297.66,
       "pkr": 996536480669223.9,
       "pln": 14674099214720.639,
       "rub": 358062270424721.06,
       "sar": 13454661462189.06,
       "sek": 39786494582946.47,
       "sgd": 4867503634054.614,
       "thb": 122434646064983.58,
       "try": 126354453728335.1,
       "twd": 117128225099186.81,
       "uah": 150089247035661.25,
       "vef": 358765652468.08136,
       "vnd": 91079825084776030,
       "zar": 66744832928534.65,
       "xdr": 2744498121903.4854,
       "xag": 120953685242.70622,
       "xau": 1369422075.0354607,
       "bits": 36502807807074.68,
       "sats": 3650280780707468
     },
     "total_volume": {
       "btc": 1735928.1257444487,
       "eth": 48810947.87407563,
       "ltc": 1566616581.0160642,
       "bch": 366179720.014878,
       "bnb": 242071672.8478171,
       "eos": 197414729827.73138,
       "xrp": 74106536767.65878,
       "xlm": 437815382136.878,
       "link": 6865705857.673341,
       "dot": 22823701582.23975,
       "yfi": 18407230.838366475,
       "usd": 170393141345.72647,
       "aed": 625852304231.4398,
       "ars": 175126458340541.06,
       "aud": 270122372650.82526,
       "bdt": 20342366436314.004,
       "bhd": 64226968340.01005,
       "bmd": 170393141345.72647,
       "brl": 1065502391463.0967,
       "cad": 244676031315.3958,
       "chf": 153319748582.8847,
       "clp": 168600605498769.44,
       "cny": 1243546184855.2466,
       "czk": 4115914486462.5605,
       "dkk": 1222093688359.8193,
       "eur": 163772686231.8796,
       "gbp": 135811001343.90457,
       "gel": 478123154616.10846,
       "hkd": 1323383891232.7866,
       "huf": 67405226408961.22,
       "idr": 2762584000638263,
       "ils": 621338589917.1915,
       "inr": 14551144028243.143,
       "jpy": 26811445987320.723,
       "krw": 248408845960769.78,
       "kwd": 52488073653.27893,
       "lkr": 50169763187369.586,
       "mmk": 357484810543334,
       "mxn": 3435977865629.715,
       "myr": 764554025218.2745,
       "ngn": 263524420336797.2,
       "nok": 1933928075645.725,
       "nzd": 301794538584.74493,
       "php": 9976432888435.33,
       "pkr": 47391305191290.42,
       "pln": 697841702518.5958,
       "rub": 17028015194976.871,
       "sar": 639850100792.9912,
       "sek": 1892087187822.5767,
       "sgd": 231479082518.16943,
       "thb": 5822504032924.819,
       "try": 6008914470343.327,
       "twd": 5570151790591.797,
       "uah": 7137646689483.279,
       "vef": 17061465242.947594,
       "vnd": 4331393653008366,
       "zar": 3174118367582.1685,
       "xdr": 130517397621.71687,
       "xag": 5752075435.812389,
       "xau": 65124258.62233666,
       "bits": 1735928125744.4487,
       "sats": 173592812574444.88
     },
     "market_cap_percentage": {
       "btc": 54.2446107287187,
       "eth": 11.731199912315203,
       "usdt": 3.8865675839303457,
       "xrp": 3.6749315040070014,
       "bnb": 2.8640568947349765,
       "sol": 2.665356195331951,
       "doge": 1.3703125175879687,
       "usdc": 1.2058780332606387,
       "steth": 0.9427691778481381,
       "ada": 0.9253122788547464
     },
     "market_cap_change_percentage_24h_usd": 1.6701637256013904,
     "updated_at": 1735107252
   }
 }
 */

struct GlobalData: Codable {
    let data: MarketDataModel?
}

struct MarketDataModel: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double
    
    enum CodingKeys: String, CodingKey {
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }
    
    var marketCap: String {
        if let item = totalMarketCap.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var volume: String {
        if let item = totalVolume.first(where: { $0.key == "usd" }) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var btcDominance: String {
        if let item = marketCapPercentage.first(where: { $0.key == "btc" }) {
            return item.value.asPercentString()
        }
        return ""
    }
}
